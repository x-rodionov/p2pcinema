<!DOCTYPE html>
<html lang="en">

<head>
	<meta charSet="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin=""
		type="font/woff2" />
	<link rel="preload" as="image" href="/_next/static/media/logo.a5f2b714.png" />
	<link rel="preload" as="image" href="/_next/static/media/playicon.018299bd.png" />
	<link rel="stylesheet" href="/_next/static/css/8ce3f946e1a11e86.css" crossorigin="" data-precedence="next" />
	<link rel="stylesheet" href="/_next/static/css/d361d64a87168220.css" crossorigin="" data-precedence="next" />
	<link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-24436e56305f23c5.js"
		crossorigin="" />
	<script src="/_next/static/chunks/fd9d1056-d56d421cdc185422.js" async="" crossorigin=""></script>
	<script src="/_next/static/chunks/69-0a554cafb2c65085.js" async="" crossorigin=""></script>
	<script src="/_next/static/chunks/main-app-4c6216e067ebc107.js" async="" crossorigin=""></script>
	<script src="/_next/static/chunks/app/page-059bcfcd23d1a327.js" async=""></script>
	<script src="/_next/static/chunks/app/layout-2cfa4f2ff7ed3218.js" async=""></script>
	<link rel="preload" href="https://www.googletagmanager.com/gtm.js?id=UA-172486649-1" as="script" />
	<title>Simple Video Player - Play local video files on the browser</title>
	<meta name="description"
		content="Simple Video Player lets you play your local video files via the browser. You can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere" />
	<meta property="og:title" content="Simple Video Player - Play local video files on the browser" />
	<meta property="og:description"
		content="Simple Video Player lets you play your local video files via the browser. You can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere" />
	<meta property="og:image:type" content="image/png" />
	<meta property="og:image:width" content="108" />
	<meta property="og:image:height" content="108" />
	<meta property="og:image" content="http://localhost:3000/opengraph-image.png?a11ace049ec67ec7" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:title" content="Simple Video Player - Play local video files on the browser" />
	<meta name="twitter:description"
		content="Simple Video Player lets you play your local video files via the browser. You can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere" />
	<meta name="twitter:image:type" content="image/png" />
	<meta name="twitter:image:width" content="108" />
	<meta name="twitter:image:height" content="108" />
	<meta name="twitter:image" content="http://localhost:3000/opengraph-image.png?a11ace049ec67ec7" />
	<link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16" />
	<meta name="next-size-adjust" />
	<script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script>
</head>

<body class="__className_36bd41"><noscript>Simple Video Player lets you play your local video files via the browser. You
		can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere.</noscript>
	<div class="App">
		<header class="App-header">
			<div class="App-logo flex content-center items-center ">
				<div class="App-icon"><img src="/_next/static/media/logo.a5f2b714.png" width="15px" alt="logo" /></div>
				<span class="App-name">Simple Video Player: p2p cinema</span>
			</div>
		</header>
		<div class="App-body">
			<div class="App-information">
				<h2>Why download a video player when you can simply play your videos with the browser?</h2>
				<h5>Your videos will not be uploaded anywhere, it is all happening on your computer.</h5>
			</div>
			<div class="VideoSelector">
				<div class="VideoDragSelector hidden "></div><button class="default-button"><img
						class="inline-block align-top" src="/_next/static/media/playicon.018299bd.png" width="30px"
						alt="Press Play icon" /> <span>Select a video file</span></button><input type="file" hidden=""
					accept="video/mp4,video/x-m4v,video/*,.mkv" />
			</div>
			<div class="App-Feature-Notes">
				<div>
					<p><b>FEATURES</b></p>
					<p>1. You can add subtitle files (SRT or WebVTT).</p>
					<p>2. Easy to use keyboard controls</p>
					<p>3. Increase volume to 400% (like you do in VLC)</p>
				</div>
				<div>
					<p><b>WHY WAS THIS BUILT?</b></p>
					<p>1.<!-- --> <a href="https://github.com/ifedapoolarewaju/simplevideoplayer#why-did-i-build-this"
							target="_blank" rel="noopener noreferrer">An abridged version of why Simple Video Player was
							built.</a></p>
					<p>2.<!-- --> <a href="https://ifedapo.com/posts/play-in-the-chrome-sandbox" target="_blank"
							rel="noopener noreferrer">A more detailed version of why Simple Video Player was built.</a>
					</p>
				</div>
			</div>
		</div>
	</div>
	<script src="/_next/static/chunks/webpack-24436e56305f23c5.js" crossorigin="" async=""></script>
	<script>(self.__next_f = self.__next_f || []).push([0]); self.__next_f.push([2, null])</script>
	<script>self.__next_f.push([1, "1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/8ce3f946e1a11e86.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script>
	<script>self.__next_f.push([1, "4:HL[\"/_next/static/css/d361d64a87168220.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script>
	<script>self.__next_f.push([1, "5:I[7690,[],\"\"]\n7:I[938,[\"931\",\"static/chunks/app/page-059bcfcd23d1a327.js\"],\"\"]\n8:I[7388,[\"185\",\"static/chunks/app/layout-2cfa4f2ff7ed3218.js\"],\"GoogleTagManager\"]\n9:I[7975,[\"185\",\"static/chunks/app/layout-2cfa4f2ff7ed3218.js\"],\"\"]\na:I[5613,[],\"\"]\nb:I[1778,[],\"\"]\nd:I[8955,[],\"\"]\ne:[]\n"])</script>
	<script>self.__next_f.push([1, "3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/8ce3f946e1a11e86.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"GTZnl3riM_a2pRP6VMz2A\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/\",\"initialTree\":[\"\",{\"children\":[\"__PAGE__\",{}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"__PAGE__\",{},[\"$L6\",[\"$\",\"div\",null,{\"className\":\"App\",\"children\":[[\"$\",\"header\",null,{\"className\":\"App-header\",\"children\":[\"$\",\"div\",null,{\"className\":\"App-logo flex content-center items-center \",\"children\":[[\"$\",\"div\",null,{\"className\":\"App-icon\",\"children\":[\"$\",\"img\",null,{\"src\":\"/_next/static/media/logo.a5f2b714.png\",\"width\":\"15px\",\"alt\":\"logo\"}]}],[\"$\",\"span\",null,{\"className\":\"App-name\",\"children\":\"Simple Video Player: p2p cinema\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"App-body\",\"children\":[[\"$\",\"div\",null,{\"className\":\"App-information\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Why download a video player when you can simply play your videos with the browser?\"}],[\"$\",\"h5\",null,{\"children\":\"Your videos will not be uploaded anywhere, it is all happening on your computer.\"}]]}],[\"$\",\"$L7\",null,{}],[\"$\",\"div\",null,{\"className\":\"App-Feature-Notes\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"b\",null,{\"children\":\"FEATURES\"}]}],[\"$\",\"p\",null,{\"children\":\"1. You can add subtitle files (SRT or WebVTT).\"}],[\"$\",\"p\",null,{\"children\":\"2. Easy to use keyboard controls\"}],[\"$\",\"p\",null,{\"children\":\"3. Increase volume to 400% (like you do in VLC)\"}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"b\",null,{\"children\":\"WHY WAS THIS BUILT?\"}]}],[\"$\",\"p\",null,{\"children\":[\"1.\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/ifedapoolarewaju/simplevideoplayer#why-did-i-build-this\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"An abridged version of why Simple Video Player was built.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"2.\",\" \",[\"$\",\"a\",null,{\"href\":\"https://ifedapo.com/posts/play-in-the-chrome-sandbox\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"A more detailed version of why Simple Video Player was built.\"}]]}]]}]]}]]}]]}],null]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"$L8\",null,{\"gtmId\":\"UA-172486649-1\"}],[\"$\",\"body\",null,{\"className\":\"__className_36bd41\",\"children\":[[\"$\",\"noscript\",null,{\"children\":\"Simple Video Player lets you play your local video files via the browser. You can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere.\"}],[\"$\",\"$L9\",null,{\"children\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d361d64a87168220.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]}]]}]]}],null]],\"initialHead\":[false,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]]\n"])</script>
	<script>self.__next_f.push([1, "c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Simple Video Player - Play local video files on the browser\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Simple Video Player lets you play your local video files via the browser. You can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"Simple Video Player - Play local video files on the browser\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"Simple Video Player lets you play your local video files via the browser. You can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image:type\",\"content\":\"image/png\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:image:width\",\"content\":\"108\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:image:height\",\"content\":\"108\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/opengraph-image.png?a11ace049ec67ec7\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:title\",\"content\":\"Simple Video Player - Play local video files on the browser\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:description\",\"content\":\"Simple Video Player lets you play your local video files via the browser. You can also add subtitle files to your video as you watch. Your videos will not be uploaded anywhere\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:image:type\",\"content\":\"image/png\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:image:width\",\"content\":\"108\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:image:height\",\"content\":\"108\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/opengraph-image.png?a11ace049ec67ec7\"}],[\"$\",\"link\",\"17\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"18\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script>
	<script>self.__next_f.push([1, ""])</script>

	<!-- p2p cinema extension below, original svp code above -->
	<style>
		#chat {
			border: 2px dotted blue;
			vertical-align: top;
			display: inline-block;
		}
	</style>
	<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
	<script>
		async function copy_link_to_clipboard() {
			const id = document.querySelector('#my_id').value;
			await navigator.clipboard.writeText(`${location.origin + location.pathname}?peer_id=${id}`);
		}
		function timeout(ms) {
			return new Promise(resolve => setTimeout(resolve, ms));
		}
		function wait_for_element(ms, element) {
			let interval;
			return new Promise(resolve1 => interval = setInterval((resolve2) => {
				if (document.getElementsByClassName(element).length) {
					clearInterval(interval);
					resolve2();
				}
			}, ms, resolve1));
		}

		const params = new URL(location.href).searchParams;
		if (params.get('peer_id')) {
			// if you are client, wait when video selector will be recreated by react
			timeout(2000).then(() => wait_for_element(200, "VideoSelector").then(() => do_main_stuff()));
		}
		else {
			// if you are server, wait when video player will be created by react
			wait_for_element(200, "VideoPlayer").then(() => do_main_stuff());
		}

		async function do_main_stuff() {
			const chat = document.createElement("div");
			chat.id = "chat";
			chat.innerHTML = `
				<p>
					<span>my id:</span>
					<input id="my_id" class="readonly-input" type="text" size="40" readonly>
					<input id="my_nickname" type="text" size="12" placeholder="nickname">
					<button onclick="copy_link_to_clipboard()">
						copy invite link for player 2
					</button>
				</p>
				<p>
					<input id="peer_id" type="text" size="40" placeholder="peer id" readonly>
				</p>
				<table>
					<tbody>
						<tr id="chat_blocks">
							<td id="app_log"></td>
							<td>
								<h3 id="nickname-main"></h3>
								<div class="chat-main"></div>
							</td>
						</tr>
					</tbody>
				</table>
			`;
			const incoming_screencast = document.createElement("video");
			incoming_screencast.id = "incoming_screencast";
			incoming_screencast.style.height = "8px";
			incoming_screencast.style.weight = "8px";
			const incoming_video = document.createElement("video");
			incoming_video.id = "incoming_video";
			incoming_video.style.height = "8px";
			incoming_video.style.weight = "8px";
			const selfie_video = document.createElement("video");
			selfie_video.id = "selfie_video";
			selfie_video.style.height = "8px";
			selfie_video.style.weight = "8px";

			const app = document.getElementsByClassName("App")[0];
			app.id = "container";
			app.style.width = "50%";
			app.style.display = "inline-block";
			app.parentElement.append(chat);
			app.parentElement.append(incoming_screencast);
			app.parentElement.append(incoming_video);
			app.parentElement.append(selfie_video);
			const controls = document.getElementsByClassName("controls")[0];
			controls && (controls.style.left = "25%");

			let my_peer = new window.Peer();
			let peer_server_connection = my_peer.connect();
			// on open will be launch when you successfully connect to PeerServer
			peer_server_connection.on('open', function () {
				// here you have conn.id
				peer_server_connection.send('register me');
			});
			my_peer.on('open', (id) => {
				const my_id = document.querySelector('#my_id');
				my_id.onfocus = my_id.onclick = event => event.target.select();
				my_id.value = id;
			});
			my_peer.on('error', (error) => {
				log('app_log', `failed to open peer. ${error}`);
				console.error(error);
				console.log(error.stack);
			});
			function log(target, message, type) {
				let new_message = document.createElement('p');
				if (type === 'sent')
					new_message.style.textAlign = 'right';
				else if (type === 'received')
					new_message.style.backgroundColor = '#D0FFF1';
				new_message.innerText = message;
				document.querySelector(`#${target}`).appendChild(new_message);
			}

			let interval_to_clear, is_game_server = true, client_just_before_screencast, main_connection, use_video;
			async function initialize_fields() {
				function init_text(id) {
					const field_element = document.querySelector(`#${id}`);
					const field = localStorage.getItem(id);
					field_element.value = field;
					field_element.onchange = field_element.oninput = event => {
						localStorage.setItem(id, event.target.value);
					};
				}
				init_text('my_nickname');

				const peer_id = params.get('peer_id');
				if (peer_id) {
					document.querySelector('#peer_id').value = peer_id;
					is_game_server = false;
				}

				try {
					const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
					const tracks = stream.getTracks();
					use_video = true;
					// use only video tracks from selfie translation
					const selfie_video_only_stream = stream;
					for (let i = 0; i < tracks.length; ++i)
						if (tracks[i].kind === "audio") selfie_video_only_stream.removeTrack(tracks[i]);
					document.getElementById("selfie_video").srcObject = selfie_video_only_stream;
				}
				catch (error) {
					console.error(error);
					console.log(error.stack);
					use_video = false;
				}

				if (!use_video) {
					try {
						await navigator.mediaDevices.getUserMedia({ video: false, audio: true });
						// use phone image for selfie translation
						document.getElementById("selfie_video").src = "./audio-call.mp4";
					}
					catch (error) {
						console.error(error);
						console.log(error.stack);
						alert("unable to play online without video or audio devices");
						return;
					}
				}

				if (!is_game_server) {
					app.style.display = "none";
					play_with_peer();
				}
			}
			initialize_fields();
			function format_message(message) {
				const nickname = document.querySelector('#my_nickname').value;
				return JSON.stringify({ nickname, message });
			}
			window.send_input = function(event_type, code) {
				if (!main_connection) return;
				main_connection.send(format_message(`${event_type}^${code}`))
			}
			window.send_command = function(command) {
				if (!main_connection) return;
				main_connection.send(format_message(`${command}©`))
			}
			function add_chat_block(connection) {
				const connection_id = connection.connectionId;
				const peer_id = connection.peer;
				const peer = document.getElementById("nickname-main");
				peer.textContent = peer_id;
				const chat = document.getElementsByClassName("chat-main")[0];
				chat.id = connection_id;
				main_connection = connection;
			}
			function update_nickname(connection, nickname) {
				const connection_id = connection.connectionId;
				const peer_id = connection.peer;
				const nickname_element = document.querySelector("#nickname-main");
				nickname_element.textContent = nickname || peer_id;
			}
			// handle incoming call
			my_peer.on('call', async (incoming_call) => {
				log('app_log', `receiving call from peer...`);
				let stream;
				try {
					stream = await navigator.mediaDevices.getUserMedia({ video: use_video, audio: true });
				}
				catch (error) {
					log('app_log', `failed to get local stream. ${error}`);
					console.error(error);
					console.log(error.stack);
					return;
				}
				try {
					incoming_call.answer(client_just_before_screencast ? undefined : stream);
					const video = document.getElementById(client_just_before_screencast ? "incoming_screencast" : "incoming_video");
					const render_video = stream => video.srcObject = stream;
					incoming_call.on('stream', render_video);
				}
				catch (error) {
					log('app_log', `failed to answer call. ${error}`);
					console.error(error);
					console.log(error.stack);
					return;
				};
				if (!client_just_before_screencast) {
					client_just_before_screencast = true;
					window.send_command("start_screencast");
				}
				else {
					console.log("connection complete");
					document.getElementById('chat').style.display = "none";
					document.getElementById('incoming_screencast').style.height = "100vh";
					document.getElementById('incoming_screencast').style.width = "33.33%";
					document.getElementById('incoming_video').style.height = "100vh";
					document.getElementById('incoming_video').style.width = "33.33%";
					document.getElementById('selfie_video').style.height = "100vh";
					document.getElementById('selfie_video').style.width = "33.33%";
					document.getElementById('incoming_video').onclick = (e) => e.target.requestPictureInPicture();
					document.getElementById('selfie_video').onclick = (e) => e.target.requestPictureInPicture();
				}
			});
			// emulate input
			window.emulate_input = function(event_type, code) {
				const eventObj = document.createEvent("Events");
				eventObj.initEvent(event_type, true, true);
				eventObj.code = code;
				document.dispatchEvent(eventObj);
			}
			// handle incoming connection
			my_peer.on('connection', (incoming_connection) => {
				log('app_log', `receiving connection from peer ${incoming_connection.peer}...`);
				incoming_connection.on('data', (data) => {
					const { nickname, message } = JSON.parse(data);
					update_nickname(incoming_connection, nickname);
					if (message.indexOf("^") > -1) {
						const p = message.split("^");
						emulate_input(p[0], p[1]);
					}
					else if (message.indexOf("©") > -1) {
						const command = message.split("©")[0];
						if (command === "start_screencast") setTimeout(screencast_to_peer, 300);
					}
					else
						log(incoming_connection.connectionId, message, 'received');
				});
				incoming_connection.on('open', () => {
					add_chat_block(incoming_connection);
					incoming_connection.send(format_message(`peer accepted play`));
					if (is_game_server) {
						document.getElementById("peer_id").value = incoming_connection.peer;
						setTimeout(peercall_to_peer, 300);
					}
				});
			});
			// start play
			async function play_with_peer() {
				const peer_id_element = document.querySelector('#peer_id');
				const peer_id = peer_id_element.value;
				log('app_log', `playing to peer ${peer_id}...`);

				let outgoing_connection;
				try {
					outgoing_connection = my_peer.connect(peer_id);
				}
				catch (error) {
					log('app_log', `failed to start play. ${error}`);
					console.error(error);
					console.log(error.stack);
					return;
				}
				outgoing_connection.on('open', () => {
					add_chat_block(outgoing_connection);
					outgoing_connection.send(format_message(`peer initiated play`));
				});
				outgoing_connection.on('data', (data) => {
					const { nickname, message } = JSON.parse(data);
					update_nickname(outgoing_connection, nickname);
					log(outgoing_connection.connectionId, message, 'received');
				});
			}
			// start peercall
			async function peercall_to_peer() {
				const peer_id = document.getElementById("peer_id").value;
				if (!peer_id)
					return;
				let stream;
				try {
					stream = await navigator.mediaDevices.getUserMedia({ video: use_video, audio: true });
				}
				catch (error) {
					log('app_log', `failed to get local stream. ${error}`);
					console.error(error);
					console.log(error.stack);
					return;
				}
				try {
					const outgoing_call = my_peer.call(peer_id, stream);
					const video = document.getElementById("incoming_video");
					const render_video = stream => video.srcObject = stream;
					outgoing_call.on('stream', render_video);
				}
				catch (error) {
					log('app_log', `failed to start call. ${error}`);
					console.error(error);
					console.log(error.stack);
					return;
				}
			}

			// start screencast
			async function screencast_to_peer() {
				const peer_id = document.getElementById("peer_id").value;
				if (!peer_id)
					return;
				const crop_element = document.getElementById('container');
				const crop_target = await CropTarget.fromElement(crop_element);
				let stream;
				try {
					stream = await navigator.mediaDevices.getDisplayMedia({
						video: true, systemAudio: "include", preferCurrentTab: true, selfBrowserSurface: "include",
					});
					if (crop_target) {
						const [video_track] = stream.getVideoTracks();
						await video_track.cropTo(crop_target);
					}
				}
				catch (error) {
					log('app_log', `failed to get local screen stream. ${error}`);
					console.error(error);
					console.log(error.stack);
					return;
				}
				try {
					const outgoing_call = my_peer.call(peer_id, stream);
					document.getElementById('container').style.width = '33.33%';
					document.getElementById("incoming_screencast").remove();
					document.getElementById("incoming_video").style.height = "100vh";
					document.getElementById("incoming_video").style.width = "33.33%";
					document.getElementById("selfie_video").style.height = "100vh";
					document.getElementById("selfie_video").style.width = "33.33%";
					document.getElementById("chat").style.display = "none";
					document.getElementById('incoming_video').onclick = (e) => e.target.requestPictureInPicture();
					document.getElementById('selfie_video').onclick = (e) => e.target.requestPictureInPicture();
				}
				catch (error) {
					log('app_log', `failed to start play screen cast. ${error}`);
					console.error(error);
					console.log(error.stack);
					return;
				}
			}

			document.addEventListener("enterpictureinpicture", (e) => {
				const container = document.getElementById('container');
				const incoming_screencast = document.getElementById('incoming_screencast');
				const incoming_video = document.getElementById('incoming_video');
				const selfie_video = document.getElementById('selfie_video');
				container && (container.style.width = "50%");
				incoming_screencast && (incoming_screencast.style.width = "50%");
				incoming_video.style.width = (e.target.id === incoming_video.id) ? "0" : "50%";
				selfie_video.style.width = (e.target.id === selfie_video.id) ? "0" : "50%";
			}, false);
			document.addEventListener("leavepictureinpicture", (e) => {
				const container = document.getElementById('container');
				const incoming_screencast = document.getElementById('incoming_screencast');
				const incoming_video = document.getElementById('incoming_video');
				const selfie_video = document.getElementById('selfie_video');
				container && (container.style.width = "33.33%");
				incoming_screencast && (incoming_screencast.style.width = "33.33%");
				incoming_video.style.width = "33.33%";
				selfie_video.style.width = "33.33%";
			}, false);

		}
	</script>
</body>

</html>